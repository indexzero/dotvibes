# Diagram 1: The Single Change Event
# What is a change in CouchDB? Think of it like a receipt for every transaction.
# Author: As explained by Laurie Voss to a new engineer

direction: right

# Package State Transition
timeline: "â±ï¸  Package Timeline" {
  style: {
    fill: "#f0f8ff"
    stroke: "#4169e1"
    stroke-width: 2
  }

  v1: |md
    ðŸ“¦ **express@4.18.0**
    seq: 1000
    rev: 1-abc123
  | {
    style: {
      fill: "#e1f5e1"
      stroke: "#43a047"
      stroke-width: 2
    }
  }

  v2: |md
    ðŸ“¦ **express@4.18.1**
    seq: 1001
    rev: 2-def456
  | {
    style: {
      fill: "#e1f5e1"
      stroke: "#43a047"
      stroke-width: 2
    }
  }

  v1 -> v2: "ðŸ”„ UPDATE"
}

# Generated Change Event
change_event: "ðŸ“‹ Change Event (Your Receipt)" {
  style: {
    fill: "#fffbf0"
    stroke: "#ffc107"
    stroke-width: 2
  }

  doc: |md
    **Change Document**
    ```json
    {
      "seq": "1001",
      "id": "express",
      "changes": [
        {"rev": "2-def456"}
      ]
    }
    ```
  | {
    style: {
      fill: "#fff3cd"
      stroke: "#ffc107"
      stroke-width: 2
      font-size: 14
    }
  }
}

# Connection from state to event
timeline.v2 -> change_event.doc: "âœ¨ Generates" {
  style: {
    stroke-dash: 3
    stroke: "#9c27b0"
  }
}

# Key Concepts
concepts: "ðŸŽ“ What This Means" {
  style: {
    fill: "#f0f4ff"
    stroke: "#2196f3"
    stroke-width: 2
  }

  seq_explain: |md
    **seq**: Unique position in
    the change stream
    (like a receipt number)
  | {
    style: {
      fill: "#e3f2fd"
      stroke: "#2196f3"
    }
  }

  id_explain: |md
    **id**: Package that changed
    (what you bought)
  | {
    style: {
      fill: "#e3f2fd"
      stroke: "#2196f3"
    }
  }

  rev_explain: |md
    **rev**: Version of the change
    (transaction details)
  | {
    style: {
      fill: "#e3f2fd"
      stroke: "#2196f3"
    }
  }
}

# Connect concepts to change event
change_event.doc -> concepts.seq_explain: "" {
  style.stroke: "#2196f3"
}
change_event.doc -> concepts.id_explain: "" {
  style.stroke: "#2196f3"
}
change_event.doc -> concepts.rev_explain: "" {
  style.stroke: "#2196f3"
}

# Types of Changes
types: "ðŸ“Š Types of Changes" {
  style: {
    fill: "#fafafa"
    stroke: "#757575"
    stroke-width: 1
  }

  create: |md
    ðŸ†• **CREATE**
    New package
  | {
    style: {
      fill: "#f5f5f5"
      stroke: "#757575"
    }
  }

  update: |md
    ðŸ”„ **UPDATE**
    Version bump
  | {
    style: {
      fill: "#f5f5f5"
      stroke: "#757575"
    }
  }

  delete: |md
    ðŸ’€ **DELETE**
    Unpublished
  | {
    style: {
      fill: "#f5f5f5"
      stroke: "#757575"
    }
  }
}