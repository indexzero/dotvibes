%% Diagram 6: Fault Tolerance

flowchart TB
  START["checkpoint.seq"]
  FETCH["GET /_changes?since=seq"]
  PROCESS["process"]
  SAVE["save seq"]

  START --> FETCH
  FETCH --> PROCESS
  PROCESS --> SAVE
  SAVE --> FETCH

  FETCH -.->|"error"| BACKOFF["delay=2^retry"]
  BACKOFF --> FETCH

  PROCESS -.->|"crash"| RELOAD["load checkpoint"]
  RELOAD --> START

  CHECKPOINT["seq:12345<br/>timestamp:2024-01-15<br/>count:45678"]
  SAVE --> CHECKPOINT