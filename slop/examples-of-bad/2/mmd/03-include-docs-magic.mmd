%% Diagram 3: include_docs API Flow Comparison

flowchart TB
  %% ---- Without include_docs (Default) ----
  subgraph Without["include_docs=false (Default)"]
    WA1["GET /registry/_changes?since=1000"]
    WA2["{seq: '1001', id: 'express', rev: '2-abc'}<br/>~200 bytes"]
    WA3["GET /registry/express"]
    WA4["Full document<br/>~50KB-2MB"]

    WA1 --> WA2
    WA2 --> WA3
    WA3 --> WA4
  end

  %% ---- With include_docs ----
  subgraph With["include_docs=true"]
    WB1["GET /registry/_changes?since=1000&include_docs=true"]
    WB2["{seq: '1001', id: 'express', rev: '2-abc',<br/>doc: {...full document...}}<br/>~50KB-2MB"]

    WB1 --> WB2
  end

  %% ---- Comparison ----
  subgraph Compare["1000 Changes Impact"]
    C1["include_docs=false<br/>1 + 1000 requests<br/>= 1001 HTTP calls"]
    C2["include_docs=true<br/>1 request<br/>= 1 HTTP call<br/>BUT 50MB+ payload"]
  end

  Without --> C1
  With --> C2

  classDef request fill:#fff3cd,stroke:#ffc107,stroke-width:2px;
  classDef response fill:#e3f2fd,stroke:#2196f3,stroke-width:2px;
  classDef compare fill:#f5f5f5,stroke:#757575,stroke-width:2px;

  class WA1,WA3,WB1 request;
  class WA2,WA4,WB2 response;
  class C1,C2 compare;